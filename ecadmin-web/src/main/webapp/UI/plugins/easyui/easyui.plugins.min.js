var groupview=$.extend({},$.fn.datagrid.defaults.view,{render:function(f,b,e){var d=[];var a=this.groups;for(var c=0;c<a.length;c++){d.push(this.renderGroup.call(this,f,c,a[c],e))}$(b).html(d.join(""))},renderGroup:function(l,n,m,a){var d=$.data(l,"datagrid");var b=d.options;var i=$(l).datagrid("getColumnFields",a);var p=[];p.push('<div class="datagrid-group" group-index='+n+">");p.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>');p.push("<tr>");if((a&&(b.rownumbers||b.frozenColumns.length))||(!a&&!(b.rownumbers||b.frozenColumns.length))){p.push('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>')}p.push('<td style="border:0;">');if(!a){p.push('<span class="datagrid-group-title">');p.push(b.groupFormatter.call(l,m.value,m.rows));p.push("</span>")}p.push("</td>");p.push("</tr>");p.push("</tbody></table>");p.push("</div>");p.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var k=m.startIndex;for(var g=0;g<m.rows.length;g++){var h=b.rowStyler?b.rowStyler.call(l,k,m.rows[g]):"";var e="";var q="";if(typeof h=="string"){q=h}else{if(h){e=h["class"]||"";q=h["style"]||""}}var o='class="datagrid-row '+(k%2&&b.striped?"datagrid-row-alt ":" ")+e+'"';var c=q?'style="'+q+'"':"";var f=d.rowIdPrefix+"-"+(a?1:2)+"-"+k;p.push('<tr id="'+f+'" datagrid-row-index="'+k+'" '+o+" "+c+">");p.push(this.renderRow.call(this,l,i,a,k,m.rows[g]));p.push("</tr>");k++}p.push("</tbody></table>");return p.join("")},bindEvents:function(d){var c=$.data(d,"datagrid");var b=c.dc;var a=b.body1.add(b.body2);var e=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(h){var g=$(h.target);var i=g.closest("span.datagrid-row-expander");if(i.length){var f=i.closest("div.datagrid-group").attr("group-index");if(i.hasClass("datagrid-row-collapse")){$(d).datagrid("collapseGroup",f)}else{$(d).datagrid("expandGroup",f)}}else{e(h)}h.stopPropagation()})},onBeforeRender:function(j,n){var b=$.data(j,"datagrid");var a=b.options;k();var c=[];for(var e=0;e<n.length;e++){var m=n[e];var l=d(m[a.groupField]);if(!l){l={value:m[a.groupField],rows:[m]};c.push(l)}else{l.rows.push(m)}}var h=0;var g=[];for(var e=0;e<c.length;e++){var l=c[e];l.startIndex=h;h+=l.rows.length;g=g.concat(l.rows)}b.data.rows=g;this.groups=c;var f=this;setTimeout(function(){f.bindEvents(j)},0);function d(p){for(var o=0;o<c.length;o++){var q=c[o];if(q.value==p){return q}}return null}function k(){if(!$("#datagrid-group-style").length){$("head").append('<style id="datagrid-group-style">'+".datagrid-group{height:25px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}"+"</style>")}}}});$.extend($.fn.datagrid.methods,{expandGroup:function(b,a){return b.each(function(){var c=$.data(this,"datagrid").dc.view;var d=c.find(a!=undefined?'div.datagrid-group[group-index="'+a+'"]':"div.datagrid-group");var e=d.find("span.datagrid-row-expander");if(e.hasClass("datagrid-row-expand")){e.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");d.next("table").show()}$(this).datagrid("fixRowHeight")})},collapseGroup:function(b,a){return b.each(function(){var c=$.data(this,"datagrid").dc.view;var d=c.find(a!=undefined?'div.datagrid-group[group-index="'+a+'"]':"div.datagrid-group");var e=d.find("span.datagrid-row-expander");if(e.hasClass("datagrid-row-collapse")){e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");d.next("table").hide()}$(this).datagrid("fixRowHeight")})}});$.extend(groupview,{refreshGroupTitle:function(g,e){var d=$.data(g,"datagrid");var c=d.options;var a=d.dc;var f=this.groups[e];var b=a.body2.children("div.datagrid-group[group-index="+e+"]").find("span.datagrid-group-title");b.html(c.groupFormatter.call(g,f.value,f.rows))},insertRow:function(f,e,k){var b=$.data(f,"datagrid");var a=b.options;var j=b.dc;var g=null;var h;for(var d=0;d<this.groups.length;d++){if(this.groups[d].value==k[a.groupField]){g=this.groups[d];h=d;break}}if(g){if(e==undefined||e==null){e=b.data.rows.length}if(e<g.startIndex){e=g.startIndex}else{if(e>g.startIndex+g.rows.length){e=g.startIndex+g.rows.length}}$.fn.datagrid.defaults.view.insertRow.call(this,f,e,k);if(e>=g.startIndex+g.rows.length){c(e,true);c(e,false)}g.rows.splice(e-g.startIndex,0,k)}else{g={value:k[a.groupField],rows:[k],startIndex:b.data.rows.length};h=this.groups.length;j.body1.append(this.renderGroup.call(this,f,h,g,true));j.body2.append(this.renderGroup.call(this,f,h,g,false));this.groups.push(g);b.data.rows.push(k)}this.refreshGroupTitle(f,h);function c(i,o){var m=o?1:2;var l=a.finder.getTr(f,i-1,"body",m);var n=a.finder.getTr(f,i,"body",m);n.insertAfter(l)}},updateRow:function(e,b,f){var c=$.data(e,"datagrid").options;$.fn.datagrid.defaults.view.updateRow.call(this,e,b,f);var a=c.finder.getTr(e,b,"body",2).closest("table.datagrid-btable");var d=parseInt(a.prev().attr("group-index"));this.refreshGroupTitle(e,d)},deleteRow:function(g,f){var b=$.data(g,"datagrid");var a=b.options;var k=b.dc;var e=k.body1.add(k.body2);var c=a.finder.getTr(g,f,"body",2).closest("table.datagrid-btable");var j=parseInt(c.prev().attr("group-index"));$.fn.datagrid.defaults.view.deleteRow.call(this,g,f);var h=this.groups[j];if(h.rows.length>1){h.rows.splice(f-h.startIndex,1);this.refreshGroupTitle(g,j)}else{e.children("div.datagrid-group[group-index="+j+"]").remove();for(var d=j+1;d<this.groups.length;d++){e.children("div.datagrid-group[group-index="+d+"]").attr("group-index",d-1)}this.groups.splice(j,1)}var f=0;for(var d=0;d<this.groups.length;d++){var h=this.groups[d];h.startIndex=f;f+=h.rows.length}}});var detailview=$.extend({},$.fn.datagrid.defaults.view,{render:function(l,e,a){var d=$.data(l,"datagrid");var b=d.options;if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var p=d.data.rows;var k=$(l).datagrid("getColumnFields",a);var n=[];n.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var h=0;h<p.length;h++){var j=b.rowStyler?b.rowStyler.call(l,h,p[h]):"";var f="";var o="";if(typeof j=="string"){o=j}else{if(j){f=j["class"]||"";o=j["style"]||""}}var m='class="datagrid-row '+(h%2&&b.striped?"datagrid-row-alt ":" ")+f+'"';var c=o?'style="'+o+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+h;n.push('<tr id="'+g+'" datagrid-row-index="'+h+'" '+m+" "+c+">");n.push(this.renderRow.call(this,l,k,a,h,p[h]));n.push("</tr>");n.push('<tr style="display:none;">');if(a){n.push("<td colspan="+(k.length+2)+' style="border-right:0">')}else{n.push("<td colspan="+(k.length)+">")}n.push('<div class="datagrid-row-detail">');if(a){n.push("&nbsp;")}else{n.push(b.detailFormatter.call(l,h,p[h]))}n.push("</div>");n.push("</td>");n.push("</tr>")}n.push("</tbody></table>");$(e).html(n.join(""))},renderRow:function(m,l,a,n,h){var b=$.data(m,"datagrid").options;var g=[];if(a&&b.rownumbers){var f=n+1;if(b.pagination){f+=(b.pageNumber-1)*b.pageSize}g.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+f+"</div></td>")}for(var j=0;j<l.length;j++){var o=l[j];var e=$(m).datagrid("getColumnOption",o);if(e){var p=h[o];var k=e.styler?(e.styler(p,h,n)||""):"";var d="";var r="";if(typeof k=="string"){r=k}else{if(g){d=k["class"]||"";r=k["style"]||""}}var q=d?'class="'+d+'"':"";var c=e.hidden?'style="display:none;'+r+'"':(r?'style="'+r+'"':"");g.push('<td field="'+o+'" '+q+" "+c+">");if(e.checkbox){c=""}else{if(e.expander){c="text-align:center;height:16px;"}else{c=r;if(e.align){c+=";text-align:"+e.align+";"}if(!b.nowrap){c+=";white-space:normal;height:auto;"}else{if(b.autoRowHeight){c+=";height:auto;"}}}}g.push('<div style="'+c+'" ');if(e.checkbox){g.push('class="datagrid-cell-check ')}else{g.push('class="datagrid-cell '+e.cellClass)}g.push('">');if(e.checkbox){g.push('<input type="checkbox" name="'+o+'" value="'+(p!=undefined?p:"")+'">')}else{if(e.expander){g.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />')}else{if(e.formatter){g.push(e.formatter(p,h,n))}else{g.push(p)}}}g.push("</div>");g.push("</td>")}}return g.join("")},insertRow:function(f,e,k){var a=$.data(f,"datagrid").options;var j=$.data(f,"datagrid").dc;var b=$(f).datagrid("getPanel");var i=j.view1;var g=j.view2;var h=false;var c=$(f).datagrid("getRows").length;if(c==0){$(f).datagrid("loadData",{total:1,rows:[k]});return}if(e==undefined||e==null||e>=c){e=c;h=true;this.canUpdateDetail=false}$.fn.datagrid.defaults.view.insertRow.call(this,f,e,k);d(true);d(false);this.canUpdateDetail=true;function d(o){var l=o?i:g;var n=l.find("tr[datagrid-row-index="+e+"]");if(h){var m=n.next().clone();n.insertAfter(n.next())}else{var m=n.next().next().clone()}m.insertAfter(n);m.hide();if(!o){m.find("div.datagrid-row-detail").html(a.detailFormatter.call(f,e,k))}}},deleteRow:function(e,b){var c=$.data(e,"datagrid").options;var a=$.data(e,"datagrid").dc;var d=c.finder.getTr(e,b);d.next().remove();$.fn.datagrid.defaults.view.deleteRow.call(this,e,b);a.body2.triggerHandler("scroll")},updateRow:function(e,g,f){var b=$.data(e,"datagrid").dc;var d=$.data(e,"datagrid").options;var a=$(e).datagrid("getExpander",g).attr("class");$.fn.datagrid.defaults.view.updateRow.call(this,e,g,f);$(e).datagrid("getExpander",g).attr("class",a);if(this.canUpdateDetail){var f=$(e).datagrid("getRows")[g];var c=$(e).datagrid("getRowDetail",g);c.html(d.detailFormatter.call(e,g,f))}},bindEvents:function(f){var e=$.data(f,"datagrid");var c=e.dc;var d=e.options;var a=c.body1.add(c.body2);var g=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(j){var h=$(j.target);var i=h.closest("tr.datagrid-row");if(!i.length){return}if(h.hasClass("datagrid-row-expander")){var k=parseInt(i.attr("datagrid-row-index"));if(h.hasClass("datagrid-row-expand")){$(f).datagrid("expandRow",k)}else{$(f).datagrid("collapseRow",k)}$(f).datagrid("fixRowHeight")}else{g(j)}j.stopPropagation()});var b="mouseover mouseout click dblclick contextmenu scroll";a.find("div.datagrid-row-detail").unbind().bind(b,function(h){h.stopPropagation()})},onBeforeRender:function(h){var b=$.data(h,"datagrid");var a=b.options;var j=b.dc;var k=$(h);var l=false;var f=k.datagrid("getColumnFields",true).concat(k.datagrid("getColumnFields"));for(var e=0;e<f.length;e++){var c=k.datagrid("getColumnOption",f[e]);if(c.expander){l=true;break}}if(!l){if(a.frozenColumns&&a.frozenColumns.length){a.frozenColumns[0].splice(0,0,{field:"_expander",expander:true,width:24,resizable:false,fixed:true})}else{a.frozenColumns=[[{field:"_expander",expander:true,width:24,resizable:false,fixed:true}]]}var k=j.view1.children("div.datagrid-header").find("table");var d=$('<td rowspan="'+a.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');if($("tr",k).length==0){d.wrap("<tr></tr>").parent().appendTo($("tbody",k))}else{if(a.rownumbers){d.insertAfter(k.find("td:has(div.datagrid-header-rownumber)"))}else{d.prependTo(k.find("tr:first"))}}}if(!b.bindDetailEvents){b.bindDetailEvents=true;var g=this;setTimeout(function(){g.bindEvents(h)},0)}},onAfterRender:function(g){var e=this;var f=$.data(g,"datagrid");var b=f.dc;var d=f.options;var a=$(g).datagrid("getPanel");$.fn.datagrid.defaults.view.onAfterRender.call(this,g);if(!f.onResizeColumn){f.onResizeColumn=d.onResizeColumn}if(!f.onResize){f.onResize=d.onResize}function c(){var j=b.header2.find("table");var i=j.find("tr.datagrid-filter-row").hide();var l=j.width()-1;var k=b.body2.find("div.datagrid-row-detail:visible")._outerWidth(l);k.find(".easyui-fluid").trigger("_resize");i.show()}d.onResizeColumn=function(m,l){if(!d.fitColumns){c()}var j=$(g).datagrid("getRows").length;for(var k=0;k<j;k++){$(g).datagrid("fixDetailRowHeight",k)}f.onResizeColumn.call(g,m,l)};d.onResize=function(j,i){if(d.fitColumns){c()}f.onResize.call(a,j,i)};this.canUpdateDetail=true;var h=b.footer1.add(b.footer2);h.find("span.datagrid-row-expander").css("visibility","hidden");$(g).datagrid("resize")}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;if(!(f.rownumbers||(f.frozenColumns&&f.frozenColumns.length))){return}var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});$.extend($.fn.datagrid.defaults,{rowHeight:25,onBeforeFetch:function(a){},onFetch:function(b,a){}});var scrollview=$.extend({},$.fn.datagrid.defaults.view,{render:function(m,e,a){var d=$.data(m,"datagrid");var b=d.options;var q=this.rows||[];if(!q.length){return}var k=$(m).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var l=this.index;var o=['<div class="datagrid-btable-top"></div>','<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var h=0;h<q.length;h++){var j=b.rowStyler?b.rowStyler.call(m,l,q[h]):"";var f="";var p="";if(typeof j=="string"){p=j}else{if(j){f=j["class"]||"";p=j["style"]||""}}var n='class="datagrid-row '+(l%2&&b.striped?"datagrid-row-alt ":" ")+f+'"';var c=p?'style="'+p+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+l;o.push('<tr id="'+g+'" datagrid-row-index="'+l+'" '+n+" "+c+">");o.push(this.renderRow.call(this,m,k,a,l,q[h]));o.push("</tr>");if(b.detailFormatter){o.push('<tr style="display:none;">');if(a){o.push("<td colspan="+(k.length+2)+' style="border-right:0">')}else{o.push("<td colspan="+(k.length)+">")}o.push('<div class="datagrid-row-detail">');if(a){o.push("&nbsp;")}else{o.push(b.detailFormatter.call(m,l,q[h]))}o.push("</div>");o.push("</td>");o.push("</tr>")}l++}o.push("</tbody></table>");o.push('<div class="datagrid-btable-bottom"></div>');$(e).html(o.join(""))},renderRow:function(m,l,a,n,h){var b=$.data(m,"datagrid").options;var g=[];if(a&&b.rownumbers){var f=n+1;if(b.pagination){f+=(b.pageNumber-1)*b.pageSize}g.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+f+"</div></td>")}for(var j=0;j<l.length;j++){var o=l[j];var e=$(m).datagrid("getColumnOption",o);if(e){var p=h[o];var k=e.styler?(e.styler(p,h,n)||""):"";var d="";var r="";if(typeof k=="string"){r=k}else{if(g){d=k["class"]||"";r=k["style"]||""}}var q=d?'class="'+d+'"':"";var c=e.hidden?'style="display:none;'+r+'"':(r?'style="'+r+'"':"");g.push('<td field="'+o+'" '+q+" "+c+">");if(e.checkbox){c=""}else{if(e.expander){c="text-align:center;height:16px;"}else{c=r;if(e.align){c+=";text-align:"+e.align+";"}if(!b.nowrap){c+=";white-space:normal;height:auto;"}else{if(b.autoRowHeight){c+=";height:auto;"}}}}g.push('<div style="'+c+'" ');if(e.checkbox){g.push('class="datagrid-cell-check ')}else{g.push('class="datagrid-cell '+e.cellClass)}g.push('">');if(e.checkbox){g.push('<input type="checkbox" name="'+o+'" value="'+(p!=undefined?p:"")+'">')}else{if(e.expander){g.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />')}else{if(e.formatter){g.push(e.formatter(p,h,n))}else{g.push(p)}}}g.push("</div>");g.push("</td>")}}return g.join("")},bindEvents:function(e){var d=$.data(e,"datagrid");var b=d.dc;var c=d.options;var a=b.body1.add(b.body2);var f=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(i){var g=$(i.target);var h=g.closest("tr.datagrid-row");if(!h.length){return}if(g.hasClass("datagrid-row-expander")){var j=parseInt(h.attr("datagrid-row-index"));if(g.hasClass("datagrid-row-expand")){$(e).datagrid("expandRow",j)}else{$(e).datagrid("collapseRow",j)}$(e).datagrid("fixRowHeight")}else{f(i)}i.stopPropagation()})},onBeforeRender:function(g){var e=$.data(g,"datagrid");var d=e.options;var b=e.dc;var a=this;e.data.firstRows=e.data.rows;e.data.rows=[];d.finder=$.extend({},$.fn.datagrid.defaults.finder,{getRow:function(k,l){var j=(typeof l=="object")?l.attr("datagrid-row-index"):l;var m=$.data(k,"datagrid").data.rows[j];if(!m){var i=$(k).datagrid("options").view;m=i.rows[j-i.index]}return m}});b.body1.add(b.body2).empty();this.rows=[];this.r1=this.r2=[];h();c();function h(){e.onLoadSuccess=d.onLoadSuccess;d.onLoadSuccess=function(){};setTimeout(function(){b.body2.unbind(".datagrid").bind("scroll.datagrid",function(i){if(e.onLoadSuccess){d.onLoadSuccess=e.onLoadSuccess;e.onLoadSuccess=undefined}if(a.scrollTimer){clearTimeout(a.scrollTimer)}a.scrollTimer=setTimeout(function(){f.call(a)},50)});b.body2.triggerHandler("scroll.datagrid")},0)}function f(){if(!d.finder.getRows(g).length){m.call(this)}else{if(!b.body2.is(":visible")){return}var j=b.view2.children("div.datagrid-header").outerHeight();var l=b.body2.children("div.datagrid-btable-top");var i=b.body2.children("div.datagrid-btable-bottom");if(!l.length||!i.length){return}var o=l.position().top+l._outerHeight()-j;var k=i.position().top-j;if(o>b.body2.height()||k<0){m.call(this)}else{if(o>0){var n=Math.floor(this.index/d.pageSize);this.getRows.call(this,g,n,function(p){this.r2=this.r1;this.r1=p;this.index=(n-1)*d.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,g)})}else{if(k<b.body2.height()){if(e.data.rows.length>=e.data.total){return}var n=Math.floor(this.index/d.pageSize)+2;if(this.r2.length){n++}this.getRows.call(this,g,n,function(p){if(!this.r2.length){this.r2=p}else{this.r1=this.r2;this.r2=p;this.index+=d.pageSize}this.rows=this.r1.concat(this.r2);this.populate.call(this,g)})}}}}function m(){var r=$(b.body2).scrollTop();var p=Math.floor(r/25);var q=Math.floor(p/d.pageSize)+1;this.getRows.call(this,g,q,function(s){this.index=(q-1)*d.pageSize;this.rows=s;this.r1=s;this.r2=[];this.populate.call(this,g);if(s&&s.length>0){b.body2.triggerHandler("scroll.datagrid")}})}}function c(){if(!d.detailFormatter){return}var m=$(g);var n=false;var j=m.datagrid("getColumnFields",true).concat(m.datagrid("getColumnFields"));for(var l=0;l<j.length;l++){var k=m.datagrid("getColumnOption",j[l]);if(k.expander){n=true;break}}if(!n){if(d.frozenColumns&&d.frozenColumns.length){d.frozenColumns[0].splice(0,0,{field:"_expander",expander:true,width:24,resizable:false,fixed:true})}else{d.frozenColumns=[[{field:"_expander",expander:true,width:24,resizable:false,fixed:true}]]}var m=b.view1.children("div.datagrid-header").find("table");var o=$('<td rowspan="'+d.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');if($("tr",m).length==0){o.wrap("<tr></tr>").parent().appendTo($("tbody",m))}else{if(d.rownumbers){o.insertAfter(m.find("td:has(div.datagrid-header-rownumber)"))}else{o.prependTo(m.find("tr:first"))}}}setTimeout(function(){a.bindEvents(g)},0)}},onAfterRender:function(b){$.fn.datagrid.defaults.view.onAfterRender.call(this,b);var a=$.data(b,"datagrid").dc;var c=a.footer1.add(a.footer2);c.find("span.datagrid-row-expander").css("visibility","hidden")},getRows:function(e,f,g){var b=$.data(e,"datagrid");var a=b.options;var d=(f-1)*a.pageSize;if(a.onBeforeFetch.call(e,f)==false){return}var i=b.data.firstRows.slice(d,d+a.pageSize);if(i.length){a.onFetch.call(e,f,i);g.call(this,i)}else{var c=$.extend({},a.queryParams,{page:f,rows:a.pageSize});if(a.sortName){$.extend(c,{sort:a.sortName,order:a.sortOrder})}if(a.onBeforeLoad.call(e,c)==false){return}$(e).datagrid("loading");var h=a.loader.call(e,c,function(j){$(e).datagrid("loaded");var j=a.loadFilter.call(e,j);a.onFetch.call(e,f,j.rows);if(j.rows&&j.rows.length){g.call(a.view,j.rows)}else{a.onLoadSuccess.call(e,j)}},function(){$(e).datagrid("loaded");a.onLoadError.apply(e,arguments)});if(h==false){$(e).datagrid("loaded");if(!b.data.firstRows.length){a.onFetch.call(e,f,b.data.firstRows);a.onLoadSuccess.call(e,b.data)}}}},populate:function(g){var d=$.data(g,"datagrid");var a=d.options;var j=d.dc;var b=a.rowHeight;if(this.rows.length){a.view.render.call(a.view,g,j.body2,false);a.view.render.call(a.view,g,j.body1,true);var f=j.body1.add(j.body2);f.children("div.datagrid-btable-top").css("height",this.index*b);f.children("div.datagrid-btable-bottom").css("height",d.data.total*b-this.rows.length*b-this.index*b);var c=[];for(var e=0;e<this.index;e++){c.push({})}d.data.rows=c.concat(this.rows);var h=j.body2.scrollTop();$(g).datagrid("setSelectionState");j.body2.scrollTop(h);a.onLoadSuccess.call(g,{total:d.data.total,rows:this.rows})}},insertRow:function(d,a,e){var c=$.data(d,"datagrid");var b=c.data;if(a==undefined||a==null){a=b.rows.length}if(a>b.rows.length){a=b.rows.length}$.fn.datagrid.defaults.view.insertRow.call(this,d,a,e);if(b.firstRows&&a<b.firstRows.length){b.firstRows.splice(a,0,e)}},deleteRow:function(c,a){var b=$(c).datagrid("getData");$.fn.datagrid.defaults.view.deleteRow.call(this,c,a);if(b.firstRows){b.firstRows.splice(a,1)}}});$.fn.datagrid.methods.baseScrollTo=$.fn.datagrid.methods.scrollTo;$.extend($.fn.datagrid.methods,{gotoPage:function(c,a,b){return c.each(function(){var e=this;var d=$(e).datagrid("options");d.view.getRows.call(d.view,e,a,function(f){this.index=(a-1)*d.pageSize;this.rows=f;this.r1=f;this.r2=[];this.populate.call(this,e);$(e).data("datagrid").dc.body2.scrollTop(this.index*d.rowHeight);if(b){b()}})})},scrollTo:function(b,a){return b.each(function(){var f=this;var d=$(f).datagrid("options");var c=d.view;if(a>=c.index&&a<c.index+c.rows.length){$(f).datagrid("baseScrollTo",a)}else{var e=Math.floor(a/d.pageSize)+1;$.fn.datagrid.methods.gotoPage($(this),e,function(){setTimeout(function(){$(f).datagrid("baseScrollTo",a)},0)})}})}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});$.extend($.fn.datagrid.methods,{doCellTip:function(c,b){function a(f,j,i,h){if($(j).text()==""){return}b=b||{};var d=h.data("datagrid");var g='style="';if(f.width){g=g+"width:"+f.width+";"}if(f.maxWidth){g=g+"max-width:"+f.maxWidth+";"}if(f.minWidth){g=g+"min-width:"+f.minWidth+";"}g=g+'"';f.content='<div class="tipcontent" '+g+">"+f.content+"</div>";$(j).tooltip({content:f.content,trackMouse:true,position:b.position,onHide:function(){$(this).tooltip("destroy")},onShow:function(){var e=$(this).tooltip("tip");if(f.tipStyler){e.css(f.tipStyler)}if(f.contentStyler){e.find("div.tipcontent").css(f.contentStyler)}}}).tooltip("show")}return c.each(function(){var f=$(this);var e=$(this).data("datagrid");if(!e.tooltip){var d=f.datagrid("getPanel").panel("panel");d.find(".datagrid-body").each(function(){var g=$(this).find("> div.datagrid-body-inner").length?$(this).find("> div.datagrid-body-inner")[0]:this;$(g).undelegate("td","mouseover").undelegate("td","mouseout").undelegate("td","mousemove").delegate("td[field="+b.itemid+"]",{"mouseover":function(l){var k=this;var m=null;if(b.specialShowFields&&b.specialShowFields.sort){for(var h=0;h<b.specialShowFields.length;h++){if(b.specialShowFields[h].field==$(this).attr("field")){m=b.specialShowFields[h]}}}if(m==null){e.factContent=$(this).find(">div").clone().css({"margin-left":"-5000px","width":"auto","display":"inline","position":"absolute"}).appendTo("body");var j=e.factContent.width();b.content=$(this).text();if(b.onlyShowInterrupt){if(j>$(this).width()){a(b,this,l,f)}}else{a(b,this,l,f)}}else{d.find(".datagrid-body").each(function(){var i=$(this).find('tr[datagrid-row-index="'+$(k).parent().attr("datagrid-row-index")+'"]');i.each(function(){var n=$(this).find('> td[field="'+m.showField+'"]');if(n.length){b.content=n.text()}})});a(b,this,l,f)}},"mouseout":function(h){if(e.factContent){e.factContent.remove();e.factContent=null}}})})}})},cancelCellTip:function(a){return a.each(function(){var c=$(this).data("datagrid");if(c.factContent){c.factContent.remove();c.factContent=null}var b=$(this).datagrid("getPanel").panel("panel");b.find(".datagrid-body").undelegate("td","mouseover").undelegate("td","mouseout").undelegate("td","mousemove")})}});$.extend($.fn.datagrid.methods,{editCell:function(b,a){return b.each(function(){var f=$(this).datagrid("options");var c=$(this).datagrid("getColumnFields",true).concat($(this).datagrid("getColumnFields"));for(var e=0;e<c.length;e++){var d=$(this).datagrid("getColumnOption",c[e]);d.editor1=d.editor;if(c[e]!=a.field){d.editor=null}}$(this).datagrid("beginEdit",a.index);for(var e=0;e<c.length;e++){var d=$(this).datagrid("getColumnOption",c[e]);d.editor=d.editor1}})}});var ___editIndex=undefined;Base.endDatagridEditing=function(a){if(___editIndex==undefined){return true}if($("#"+a).datagrid("validateRow",___editIndex)){$("#"+a).datagrid("endEdit",___editIndex);___editIndex=undefined;return true}else{return false}};Base.onClickCell=function(a,c,b,d){if(Base.endDatagridEditing(d)){$("#"+d).datagrid("selectRow",a).datagrid("editCell",{index:a,field:c});___editIndex=a}};Base.onClickRowEdit=function(b,d,c,e){if(___editIndex!=b){if(Base.endDatagridEditing(e)){$("#"+e).datagrid("selectRow",b).datagrid("beginEdit",b);var a=$("#"+e).datagrid("getEditor",{index:b,field:d});if(a){($(a.target).data("textbox")?$(a.target).textbox("textbox"):$(a.target)).focus()}___editIndex=b}else{$("#"+e).datagrid("selectRow",___editIndex)}}};function ___createDatagridColumnMenu(e,f){e=$("<div/>").appendTo("body");e.menu({onClick:function(g){if(g.iconCls=="fa-check"){$("#"+f).datagrid("hideColumn",g.name);e.menu("setIcon",{target:g.target,iconCls:"icon-empty"})}else{$("#"+f).datagrid("showColumn",g.name);e.menu("setIcon",{target:g.target,iconCls:"fa-check"})}}});var a=$("#"+f).datagrid("getColumnFields");for(var c=0;c<a.length;c++){var d=a[c];var b=$("#"+f).datagrid("getColumnOption",d);e.menu("appendItem",{text:b.title,name:d,iconCls:"fa-check"})}return e}$.extend($.fn.validatebox.defaults.rules,{phone:{validator:function isPhone(a){a==$(this).val();var b=RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|14[57])[0-9]{8}$/).test(a);if(b){return true}else{return false}},message:"您输入的手机号码不正确"},idcard:{validator:function checkIdcard(e){e=$(this).val();e=e.toUpperCase();if(!(/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(e))){return false}var f,l;f=e.length;if(f==15){l=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var k=e.match(l);var c=new Date("19"+k[2]+"/"+k[3]+"/"+k[4]);var b;b=(c.getYear()==Number(k[2]))&&((c.getMonth()+1)==Number(k[3]))&&(c.getDate()==Number(k[4]));if(!b){return false}else{var h=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var g=0,d;e=e.substr(0,6)+"19"+e.substr(6,e.length-6);for(d=0;d<17;d++){g+=e.substr(d,1)*h[d]}e+=j[g%11];return true}}if(f==18){l=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);var k=e.match(l);var c=new Date(k[2]+"/"+k[3]+"/"+k[4]);var b;b=(c.getFullYear()==Number(k[2]))&&((c.getMonth()+1)==Number(k[3]))&&(c.getDate()==Number(k[4]));if(!b){return false}else{var a;var h=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var g=0,d;for(d=0;d<17;d++){g+=e.substr(d,1)*h[d]}a=j[g%11];if(a!=e.substr(17,1)){return false}return true}}return false},message:"您输入的身份证号不正确"},url:{validator:function(a){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},message:"您输入的不合URL格式要求"},zipcode:{validator:function(a){return/[0-9]\d{5}(?!\d)/.test(a)},message:"您输入的邮编不正确"},ip:{validator:function(a){return/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))$/.test(a)},message:"您输入的IP地址格式不正确"},integer:{validator:function(a){return/^-?[1-9]\d*$/.test(a)},message:"只能输入整数"},chinese:{validator:function(a){return/^[\u4e00-\u9fa5]+$/.test(a)},message:"只能输入中文"},number:{validator:function(a,c){try{parseInt(a);parseFloat(a)}catch(b){return false}if(!jQuery.isArray(c)){return true}if(c[0]===""&&c[1]!==""){this.message="输入的数值必须小于或等于{1}";return Number(a)<=Number(c[1])}else{if(c[0]!==""&&c[1]===""){this.message="输入的数值必须大于或等于{0}";return Number(a)>=Number(c[0])}else{this.message="输入的数值必须在{0}到{1}之间";return(Number(a)>=Number(c[0]))&&(a<=Number(c[1]))}}return true},message:"输入的数值必须在{0}到{1}之间"}});if($.fn.pagination){$.fn.pagination.defaults.beforePageText="第";$.fn.pagination.defaults.afterPageText="页,共{pages}页";$.fn.pagination.defaults.displayMsg="显示{from}到{to},共{total}记录"}if($.fn.datagrid){$.fn.datagrid.defaults.loadMsg="正在处理，请稍待。。。"}if($.fn.treegrid&&$.fn.datagrid){$.fn.treegrid.defaults.loadMsg=$.fn.datagrid.defaults.loadMsg}if($.messager){$.messager.defaults.ok="确定";$.messager.defaults.cancel="取消"}$.map(["validatebox","textbox","filebox","searchbox","combo","combobox","combogrid","combotree","datebox","datetimebox","numberbox","spinner","numberspinner","timespinner","datetimespinner"],function(a){if($.fn[a]){$.fn[a].defaults.missingMessage="该输入项为必输项"}});if($.fn.validatebox){$.fn.validatebox.defaults.rules.email.message="请输入有效的电子邮件地址";$.fn.validatebox.defaults.rules.url.message="请输入有效的URL地址";$.fn.validatebox.defaults.rules.length.message="输入内容长度必须介于{0}和{1}之间";$.fn.validatebox.defaults.rules.remote.message="请修正该字段"}if($.fn.calendar){$.fn.calendar.defaults.weeks=["日","一","二","三","四","五","六"];$.fn.calendar.defaults.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}if($.fn.datebox){$.fn.datebox.defaults.currentText="今天";$.fn.datebox.defaults.closeText="关闭";$.fn.datebox.defaults.okText="确定";$.fn.datebox.defaults.formatter=function(b){var e=b.getFullYear();var a=b.getMonth()+1;var c=b.getDate();return e+"-"+(a<10?("0"+a):a)+"-"+(c<10?("0"+c):c)};$.fn.datebox.defaults.parser=function(c){if(!c){return new Date()}var b=c.split("-");var f=parseInt(b[0],10);var a=parseInt(b[1],10);var e=parseInt(b[2],10);if(!isNaN(f)&&!isNaN(a)&&!isNaN(e)){return new Date(f,a-1,e)}else{return new Date()}}}if($.fn.datetimebox&&$.fn.datebox){$.extend($.fn.datetimebox.defaults,{currentText:$.fn.datebox.defaults.currentText,closeText:$.fn.datebox.defaults.closeText,okText:$.fn.datebox.defaults.okText})}if($.fn.datetimespinner){$.fn.datetimespinner.defaults.selections=[[0,4],[5,7],[8,10],[11,13],[14,16],[17,19]]};